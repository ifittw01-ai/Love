<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ¶è³‡æ–™ç´€éŒ„ - AIè‡ªå‹•å¼•å®¢ç³»çµ±</title>
    <link rel="stylesheet" href="styles.css">
    <!-- SheetJS ç”¨æ–¼ç”Ÿæˆ Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        .records-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .records-header h1 {
            font-size: 28px;
            color: #333;
            margin: 0;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .stats-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
        }

        .stats-box h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
            opacity: 0.9;
        }

        .stats-box .count {
            font-size: 48px;
            font-weight: bold;
            margin: 0;
        }

        .info-message {
            background: #e7f3ff;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #0d47a1;
        }

        .info-message strong {
            display: block;
            margin-bottom: 5px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .data-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .data-table tbody tr {
            transition: background-color 0.2s ease;
        }

        .data-table tbody tr:hover {
            background-color: #f8f9ff;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-data-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #dc3545;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .device-info {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        .device-info strong {
            display: block;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .records-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-buttons {
                width: 100%;
            }

            .btn {
                flex: 1;
                justify-content: center;
            }

            .table-container {
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="records-container">
        <div class="records-header">
            <h1>ğŸ“Š å®¢æˆ¶è³‡æ–™ç´€éŒ„</h1>
            <div class="header-buttons">
                <button class="btn btn-success" onclick="exportToExcel()">
                    ğŸ“¥ åŒ¯å‡º Excel
                </button>
                <button class="btn btn-danger" onclick="clearAllData()">
                    ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™
                </button>
                <a href="setup.html" class="btn btn-secondary">
                    âš™ï¸ ç³»çµ±è¨­å®š
                </a>
                <a href="index.html" class="btn btn-secondary">
                    â† è¿”å›é¦–é 
                </a>
            </div>
        </div>

        <div class="device-info">
            <strong>ğŸ’¡ æç¤ºï¼š</strong>
            æ­¤è³‡æ–™å„²å­˜åœ¨æ‚¨ç›®å‰ä½¿ç”¨çš„è¨­å‚™å’Œç€è¦½å™¨ä¸­ã€‚ä¸åŒè¨­å‚™æˆ–ç€è¦½å™¨çš„è³‡æ–™æ˜¯ç¨ç«‹çš„ï¼Œä¸æœƒäº’ç›¸å…±ç”¨ã€‚
        </div>

        <div class="stats-box">
            <h2>æœ¬è¨­å‚™å·²å„²å­˜çš„å®¢æˆ¶è³‡æ–™</h2>
            <p class="count" id="totalCount">0</p>
            <p>ç­†è³‡æ–™</p>
        </div>

        <div class="info-message" id="infoMessage" style="display: none;">
            <strong>â„¹ï¸ è³‡è¨Š</strong>
            <span id="infoText"></span>
        </div>

        <div class="table-container" id="tableContainer" style="display: none;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>å§“å</th>
                        <th>é›»å­éƒµä»¶</th>
                        <th>é›»è©±</th>
                        <th>åœ‹å®¶/åœ°å€</th>
                        <th>è¡Œæ¥­</th>
                        <th>è©•ä¼°åœ°å€</th>
                        <th>LINE ID</th>
                        <th>WhatsApp</th>
                        <th>è¨‚é–±é›»å­å ±</th>
                        <th>å»ºç«‹æ™‚é–“</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="dataTableBody">
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <div id="noDataState" class="no-data">
            <div class="no-data-icon">ğŸ“­</div>
            <p>ç›®å‰æ²’æœ‰å®¢æˆ¶è³‡æ–™</p>
            <p><a href="index.html" class="btn btn-primary" style="margin-top: 20px;">é–‹å§‹æ”¶é›†è³‡æ–™</a></p>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'customerLeads';

        // è¼‰å…¥è³‡æ–™
        function loadData() {
            try {
                const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                displayData(data);
                return data;
            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                showInfo('è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤');
                return [];
            }
        }

        // é¡¯ç¤ºè³‡æ–™
        function displayData(data) {
            const tbody = document.getElementById('dataTableBody');
            const tableContainer = document.getElementById('tableContainer');
            const noDataState = document.getElementById('noDataState');
            const totalCount = document.getElementById('totalCount');

            totalCount.textContent = data.length;

            if (data.length === 0) {
                tableContainer.style.display = 'none';
                noDataState.style.display = 'block';
                return;
            }

            tableContainer.style.display = 'block';
            noDataState.style.display = 'none';

            tbody.innerHTML = data.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${escapeHtml(item.fullName)}</td>
                    <td>${escapeHtml(item.email)}</td>
                    <td>${escapeHtml(item.phone)}</td>
                    <td>${getCountryName(item.country)}</td>
                    <td>${getIndustryName(item.industry)}</td>
                    <td>${getRegionName(item.region)}</td>
                    <td>${escapeHtml(item.lineId || 'æœªæä¾›')}</td>
                    <td>${escapeHtml(item.whatsapp || 'æœªæä¾›')}</td>
                    <td>${item.newsletter ? 'æ˜¯' : 'å¦'}</td>
                    <td>${formatDateTime(item.createdAt)}</td>
                    <td>
                        <button class="action-btn" onclick="deleteItem(${item.id})">
                            åˆªé™¤
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // åŒ¯å‡º Excel
        function exportToExcel() {
            const data = loadData();

            if (data.length === 0) {
                alert('æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º');
                return;
            }

            // æº–å‚™ Excel è³‡æ–™
            const excelData = data.map((item, index) => ({
                'åºè™Ÿ': index + 1,
                'å§“å': item.fullName,
                'é›»å­éƒµä»¶': item.email,
                'é›»è©±': item.phone,
                'åœ‹å®¶/åœ°å€': getCountryName(item.country),
                'è¡Œæ¥­': getIndustryName(item.industry),
                'è©•ä¼°åœ°å€': getRegionName(item.region),
                'LINE ID': item.lineId || 'æœªæä¾›',
                'WhatsApp': item.whatsapp || 'æœªæä¾›',
                'è¨‚é–±é›»å­å ±': item.newsletter ? 'æ˜¯' : 'å¦',
                'å»ºç«‹æ™‚é–“': formatDateTime(item.createdAt)
            }));

            // å»ºç«‹å·¥ä½œè¡¨
            const ws = XLSX.utils.json_to_sheet(excelData);

            // è¨­å®šæ¬„ä½å¯¬åº¦
            ws['!cols'] = [
                { wch: 6 },  // åºè™Ÿ
                { wch: 15 }, // å§“å
                { wch: 25 }, // é›»å­éƒµä»¶
                { wch: 15 }, // é›»è©±
                { wch: 12 }, // åœ‹å®¶
                { wch: 20 }, // è¡Œæ¥­
                { wch: 12 }, // è©•ä¼°åœ°å€
                { wch: 18 }, // LINE ID
                { wch: 18 }, // WhatsApp
                { wch: 12 }, // è¨‚é–±
                { wch: 20 }  // æ™‚é–“
            ];

            // å»ºç«‹å·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'å®¢æˆ¶è³‡æ–™');

            // ç”Ÿæˆæª”æ¡ˆåç¨±
            const fileName = `å®¢æˆ¶è³‡æ–™_${new Date().toISOString().split('T')[0]}.xlsx`;

            // åŒ¯å‡ºæª”æ¡ˆ
            XLSX.writeFile(wb, fileName);

            showInfo(`âœ… å·²æˆåŠŸåŒ¯å‡º ${data.length} ç­†è³‡æ–™åˆ° ${fileName}`);
        }

        // åˆªé™¤å–®ç­†è³‡æ–™
        function deleteItem(id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿ')) {
                return;
            }

            try {
                let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                data = data.filter(item => item.id !== id);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                
                loadData();
                showInfo('âœ… è³‡æ–™å·²åˆªé™¤');
            } catch (error) {
                console.error('åˆªé™¤å¤±æ•—:', error);
                alert('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        // æ¸…é™¤æ‰€æœ‰è³‡æ–™
        function clearAllData() {
            const data = loadData();
            
            if (data.length === 0) {
                alert('ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥æ¸…é™¤');
                return;
            }

            if (!confirm(`ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ ${data.length} ç­†è³‡æ–™å—ï¼Ÿ\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼\nå»ºè­°å…ˆåŒ¯å‡º Excel å‚™ä»½ã€‚`)) {
                return;
            }

            try {
                localStorage.removeItem(STORAGE_KEY);
                loadData();
                showInfo('âœ… æ‰€æœ‰è³‡æ–™å·²æ¸…é™¤');
            } catch (error) {
                console.error('æ¸…é™¤å¤±æ•—:', error);
                alert('æ¸…é™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showInfo(text) {
            const infoMessage = document.getElementById('infoMessage');
            const infoText = document.getElementById('infoText');
            
            infoText.textContent = text;
            infoMessage.style.display = 'block';

            setTimeout(() => {
                infoMessage.style.display = 'none';
            }, 5000);
        }

        // å·¥å…·å‡½æ•¸
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function getCountryName(code) {
            const countries = {
                'TW': 'å°ç£',
                'HK': 'é¦™æ¸¯',
                'SG': 'æ–°åŠ å¡',
                'MY': 'é¦¬ä¾†è¥¿äº',
                'CN': 'ä¸­åœ‹',
                'US': 'ç¾åœ‹',
                'other': 'å…¶ä»–'
            };
            return countries[code] || code;
        }

        function getIndustryName(code) {
            const industries = {
                'spiritual': 'èº«å¿ƒéˆå°å¸«',
                'beauty': 'ç¾å®¹ / ç¾é«®',
                'education': 'æ•™è‚² / åŸ¹è¨“',
                'insurance': 'ä¿éšª / é‡‘è',
                'realestate': 'æˆ¿åœ°ç”¢',
                'consultant': 'è«®è©¢é¡§å•',
                'freelancer': 'è‡ªç”±å·¥ä½œè€…',
                'coach': 'å€‹äººæ•™ç·´',
                'ecommerce': 'é›»å•† / å¾®å•†',
                'other': 'å…¶ä»–'
            };
            return industries[code] || code;
        }

        function getRegionName(code) {
            const regions = {
                'north': 'åŒ—éƒ¨',
                'central': 'ä¸­éƒ¨',
                'south': 'å—éƒ¨'
            };
            return regions[code] || (code || 'æœªæä¾›');
        }

        // é é¢è¼‰å…¥æ™‚è¼‰å…¥è³‡æ–™
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });
    </script>
</body>
</html>

